/*! minnpost-state-fair-bingo - LATEST VERSION - 2014-08-26
* https://github.com/minnpost/minnpost-state-fair-bingo
* Copyright (c) 2014 MinnPost; Licensed MIT */

define("helpers",["jquery","underscore"],function(a,b){var c={};return c.overrideBackboneAJAX=function(){Backbone.ajax=function(){var a=arguments;return a[0].dataTypeForce!==!0&&(a[0].dataType="jsonp",a[0].jsonpCallback="mpServerSideCachingHelper"+b.hash(a[0].url)),Backbone.$.ajax.apply(Backbone.$,a)}},c.isMSIE=function(){var a=/(msie) ([\w.]+)/i.exec(navigator.userAgent);return a?parseInt(a[2],10):!1},c.jsonpRequest=function(c,d){return options.dataType="jsonp",options.jsonpCallback="mpServerSideCachingHelper"+b.hash(options.url),d.remoteProxy&&(options.url=options.url+"&callback=mpServerSideCachingHelper",options.url=d.remoteProxy+encodeURIComponent(options.url),options.cache=!0),a.ajax.apply(a,[options])},c.getLocalData=function(d,e){var f=!1,g=[];return d=b.isArray(d)?d:[d],e&&e.paths&&0===e.paths.data.indexOf("http")&&(f=!0),b.each(d,function(b){var d;d=f?c.jsonpRequest({url:proxyPrefix+encodeURI(e.paths.data+b)},e):a.getJSON(e.paths.data+b),g.push(d)}),a.when.apply(a,g)},c.parseQueryString=function(){var a={},c=function(a){return decodeURIComponent(a.replace(/\+/g," "))},d=location.search.substring(1),e=d.split("&");return b.each(e,function(b){var d=b.split("=");d.length>1&&(a[c(d[0])]=c(d[1]))}),a},c}),define("text!templates/application.underscore",[],function(){return'<div class="application-container">\n  <div class="message-container"></div>\n\n  <div class="content-container">\n\n    <div class="pick">\n      <button class="refresh button primary large" title="Pick another Bingo card."><i class="fa fa-refresh"></i></button>\n      <button class="print button primary large" title="Print out card."><i class="fa fa-print"></i></button>\n    </div>\n\n    <div class="card">\n      <div class="loading-container">\n        <i class="loading"></i> Loading...\n      </div>\n\n      <img src="<%= card %>" />\n    </div>\n\n  </div>\n\n  <div class="footnote-container">\n    <div class="footnote">\n      <p>Some code, techniques, and data on <a href="https://github.com/minnpost/minnpost-state-fair-bingo" target="_blank">Github</a>.</p>\n\n    </div>\n  </div>\n</div>\n'}),define("text!templates/print-window.underscore",[],function(){return'<html>\n<head>\n  <title>Temporary Printing Window</title>\n\n  <script>\n    function step1() {\n      setTimeout(\'step2()\', 100);\n    }\n    function step2() {\n      window.print();\n      window.close();\n    }\n  </script>\n\n  <style>\n    * { margin: 0 !important; padding: 0 !important; }\n    html, body {\n      height:100%;\n      overflow: hidden;\n      background: #FFF;\n      font-size: 9.5pt;\n    }\n    img {\n      display: block;\n      max-width: 99%;\n      max-height: 99%;\n      margin: 0 auto !important;\n    }\n  </style>\n</head>\n<body onLoad="step1()">\n  <img src="<%= card %>"/>\n</body>\n</html>\n'}),define("minnpost-state-fair-bingo",["jquery","underscore","imagesloaded","helpers","text!templates/application.underscore","text!templates/print-window.underscore"],function(a,b,c,d,e,f){var g=function(c){this.options=b.extend(this.defaultOptions,c),this.el=this.options.el,this.$el=a(this.el),this.$=function(a){return this.$el.find(a)},this.loadApp()};return b.extend(g.prototype,{start:function(){var a=this;this.options.cards=b.map(this.options.cards,function(b){return b=a.options.paths.images+b,0!==b.indexOf("http")&&0!==b.indexOf("//")&&(b=window.location.origin+window.location.pathname+b),b}),this.card=this.newCard(),this.$el.html(b.template(e,{card:this.card,options:this.options})),this.imageLoaded(),this.$(".pick .refresh").on("click",function(b){b.preventDefault(),a.readyImageLoad(),a.$(".card img").fadeOut().attr("src",a.newCard()),a.imageLoaded()}),this.$(".pick .print").on("click",function(b){b.preventDefault(),a.printImage()})},imageLoaded:function(){var a=this;this.$(".card img").imagesLoaded().always(function(){a.$(".card img").fadeIn("fast"),a.$(".card .loading-container").slideUp("fast")})},readyImageLoad:function(){this.$(".card img").fadeOut("fast"),this.$(".card .loading-container").slideDown("fast")},newCard:function(){var a,c=this.card||this.options.cards[0];if(this.options.cards.length>1){do a=b.sample(this.options.cards);while(a===c)}else a=c;return this.card=a,a},printImage:function(){var a=window.open("about:blank","_new");a.document.open(),a.document.write(b.template(f,{card:this.card})),a.document.close()},defaultOptions:{projectName:"minnpost-state-fair-bingo",cards:["minnpost-state-fair-bingo-card-01.png","minnpost-state-fair-bingo-card-02.png","minnpost-state-fair-bingo-card-03.png","minnpost-state-fair-bingo-card-04.png"],remoteProxy:null,el:".minnpost-state-fair-bingo-container",availablePaths:{local:{css:[".tmp/css/main.css"],images:"images/",data:"data/"},build:{css:["//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css","dist/minnpost-state-fair-bingo.libs.min.css","dist/minnpost-state-fair-bingo.latest.min.css"],ie:["dist/minnpost-state-fair-bingo.libs.min.ie.css","dist/minnpost-state-fair-bingo.latest.min.ie.css"],images:"dist/images/",data:"dist/data/"},deploy:{css:["//netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css","https://s3.amazonaws.com/data.minnpost/projects/minnpost-state-fair-bingo/minnpost-state-fair-bingo.libs.min.css","https://s3.amazonaws.com/data.minnpost/projects/minnpost-state-fair-bingo/minnpost-state-fair-bingo.latest.min.css"],ie:["https://s3.amazonaws.com/data.minnpost/projects/minnpost-state-fair-bingo/minnpost-state-fair-bingo.libs.min.ie.css","https://s3.amazonaws.com/data.minnpost/projects/minnpost-state-fair-bingo/minnpost-state-fair-bingo.latest.min.ie.css"],images:"https://s3.amazonaws.com/data.minnpost/projects/minnpost-state-fair-bingo/images/",data:"https://s3.amazonaws.com/data.minnpost/projects/minnpost-state-fair-bingo/data/"}}},loadApp:function(){this.determinePaths(),this.getLocalAssests(function(a){this.renderAssests(a),this.start()})},determinePaths:function(){var a;this.options.deployment="deploy",-1!==window.location.host.indexOf("localhost")&&(this.options.deployment="local",a=d.parseQueryString(),b.isObject(a)&&b.isString(a.mpDeployment)&&(this.options.deployment=a.mpDeployment)),this.options.paths=this.options.availablePaths[this.options.deployment]},getLocalAssests:function(b){var c=this;"local"===this.options.deployment?a.getJSON("bower.json",function(a){b.apply(c,[a.dependencyMap])}):b.apply(this,[])},renderAssests:function(c){var e=d.isMSIE()&&d.isMSIE()<=8;b.isObject(c)&&b.each(c,function(c){c.css&&b.each(c.css,function(b){b=b.match(/^(http|\/\/)/)?b:"bower_components/"+b+".css",a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')}),c.ie&&e&&b.each(c.ie,function(b){b=b.match(/^(http|\/\/)/)?b:"bower_components/"+b+".css",a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')})}),b.each(this.options.paths.css,function(b){a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')}),e&&b.each(this.options.paths.ie,function(b){a("head").append('<link rel="stylesheet" href="'+b+'" type="text/css" />')}),this.$el.addClass("processed")}}),g}),require(["jquery","minnpost-state-fair-bingo"],function(a,b){a(document).ready(function(){new b})});